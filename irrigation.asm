ORG 00H
MOV R6,#06H
MOV P3,#00H
MOV P0,#00H
MOV A,#38H
ACALL CMD
MOV A,#0FH
ACALL CMD
MOV A,#01H
ACALL CMD
MOV A,#06H
ACALL CMD
MOV A,#81H
ACALL CMD
MOV DPTR,#0190H
HEREAGAIN1:CLR A
MOVC A,@A+DPTR
CJNE A,#'$',TOCONT1
SJMP INIT
TOCONT1:ACALL DAT
INC DPTR
SJMP HEREAGAIN1

INIT:
	JB P2.3,INIT1
	SJMP INIT2

INIT1:
	JB P2.4,OFF
	SJMP START

INIT2:
	JB P2.4,FSTART
	SJMP FSTOP

OFF:
	CJNE R6,#00H,HEREOFF
	SJMP INIT
	HEREOFF:MOV P3,#00H
	ACALL LCDOFF
	ACALL DELAY
	MOV R6,#00H
	SJMP INIT

FSTART:	CJNE R6,#01H,HEREFSTART
	SJMP INIT
	HEREFSTART:
	MOV P3,#0FFH
	ACALL LCDFSTART
	ACALL DELAY
	MOV R6,#01H
	SJMP INIT

FSTOP:
	CJNE R6,#02H,HEREFSTOP
	SJMP INIT
	HEREFSTOP:
	MOV P3,#00H
	ACALL LCDFSTOP
	ACALL DELAY
	MOV R6,#02H
	SJMP INIT

START:
	CJNE R6,#03H,HERESTART
	CLR A
	MOV A,P0
	CPL A
	MOV P3,A
	SJMP INIT
	HERESTART:
	CLR A
	MOV A,P0
	CPL A
	MOV P3,A
	ACALL LCDNORMAL
	ACALL DELAY
	MOV R6,#03H
	SJMP INIT

DELAY:
	MOV R2,#07FH
	UP:MOV R3,#0FFH
	HERE:DJNZ R3, HERE
	DJNZ R2, UP	
	RET

LCDNORMAL:
	MOV DPTR,#0100H
	ACALL DISPCOMM
	RET

LCDFSTOP:
	MOV DPTR,#0160H
	ACALL DISPCOMM
	RET

LCDFSTART:
	MOV DPTR,#0130H
	ACALL DISPCOMM
	RET

LCDOFF:
	MOV DPTR,#0210H
	ACALL DISPCOMM
	RET

DISPCOMM:
	MOV A,#88H
	ACALL CMD
	HEREAGAIN:CLR A
	MOVC A,@A+DPTR
	CJNE A,#'$',TOCONT
	SJMP TORET
	TOCONT:ACALL DAT
	INC DPTR
	SJMP HEREAGAIN
	TORET:RET

CMD:
	MOV P1,A
	CLR P2.1
	CLR P2.2
	SETB P2.0
	CLR P2.0
	ACALL DELAY
	RET
DAT:
	MOV P1,A
	SETB P2.1
	CLR P2.2
	SETB P2.0
	CLR P2.0
	ACALL DELAY
	CLR A
	RET

ORG 0100H
DB 'S','E','N','S','O','R','S','$'

ORG 0130H
DB 'F','S','T','A','R','T',' ','$'

ORG 0160H
DB 'F','S','T','O','P',' ',' ','$'

ORG 0190H
DB 'S','T','A','T','U','S',':','$'

ORG 0210H
DB 'O','F','F',' ',' ',' ',' ','$'

END